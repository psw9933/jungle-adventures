{"version":3,"sources":["battleView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\battle","sourcesContent":["import {gameProtocol} from \"../game/gameProtocol\"\r\nimport { playerRes } from \"../game/gameRes\"\r\nconst {ccclass, property} = cc._decorator;\r\nimport GameInfo from \"../module/GameInfo\"\r\n\r\n@ccclass\r\nexport default class battleView extends cc.Component {\r\n\r\n\r\n    @property(cc.Prefab)\r\n    PlayerPre:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    bossPre:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    bulletPre:cc.Prefab=null;\r\n\r\n    @property(cc.Node)\r\n    collisionLayer:cc.Node=null;\r\n\r\n    /**角色运动类型 */\r\n    @property\r\n    actionType = gameProtocol.playerControl.actionType.inTheAir;\r\n\r\n    // @property(cc.Prefab)\r\n    // JoystickPre:cc.Prefab=null;\r\n\r\n     btnControlNode=null\r\n     playerNode:any=null;\r\n     bossNode:any=null\r\n     roleAniName:any=null;\r\n     roleHealthValue:any=null;\r\n     roleWeaponName:any=null;\r\n\r\n     landArea:any=null;\r\n     _actionType:any=null;\r\n\r\n     bulletPool:any=null;\r\n    onLoad () {\r\n        this.initEvent()\r\n        this.initRoleInfo();\r\n\r\n        this.initPlayer();\r\n\r\n        this.initBoss();\r\n\r\n        this.initBtnControl();\r\n        this.initCollisionArea();\r\n        \r\n        this.initBulletPool()\r\n    }\r\n    private initEvent() {\r\n        cc.systemEvent.on(gameProtocol.event.playerShooting, this.shoot, this);\r\n    }\r\n    private clearEvent() {\r\n        cc.systemEvent.off(gameProtocol.event.playerShooting, this.shoot, this);\r\n    }\r\n    initBtnControl(){\r\n        cc.find('operationMenu',this.node).getComponent('gameKeyControl').playerControl=this.playerNode.getComponent('playerControl');\r\n    }\r\n    initCollisionArea(){\r\n        //this.landArea=cc.find('background/land',this.node).getComponent(cc.BoxCollider)\r\n        //cc.log(this.landArea)\r\n    }\r\n    initPlayer(){\r\n        this.playerNode=cc.instantiate(this.PlayerPre);\r\n        //this.playerNode.getComponent(sp.SkeletonData);\r\n        this.playerNode.parent=this.collisionLayer;\r\n        let c_pos=cc.find('background/circle',this.node).getPosition();\r\n        this.playerNode.setPosition(c_pos.x,c_pos.y);\r\n        this.collisionLayer.getComponent('collisionDetection').initPlayer();\r\n\r\n        cc.log(this.playerNode.getPosition())\r\n\r\n        let path = playerRes[this.roleAniName].aniPath;\r\n        let self = this;\r\n        cc.loader.loadRes(path, sp.SkeletonData, function (err, _SkeletonData) {\r\n            if (err) {\r\n                cc.error(err.message || err);\r\n                return;\r\n            }\r\n            else {\r\n                \r\n                self.playerNode.getComponent(sp.Skeleton).skeletonData = _SkeletonData;\r\n                self.playerNode.getComponent(sp.Skeleton).setSkin(self.roleWeaponName);\r\n                self.playerNode.getComponent(sp.Skeleton).setAnimation(0, 'idle', true);\r\n            }\r\n        });\r\n    }\r\n\r\n    initBoss(){\r\n        this.bossNode=cc.instantiate(this.bossPre);\r\n        this.bossNode.parent=this.collisionLayer\r\n        let c_pos=cc.find('background/circle',this.node).getPosition();\r\n        this.bossNode.setPosition(-c_pos.x,c_pos.y);\r\n        this.collisionLayer.getComponent('collisionDetection').initBoss();\r\n        cc.log(this.bossNode.getPosition())\r\n\r\n\r\n        let path = playerRes['boss'].aniPath;\r\n        let self = this;\r\n        cc.loader.loadRes(path, sp.SkeletonData, function (err, _SkeletonData) {\r\n            if (err) {\r\n                cc.error(err.message || err);\r\n                return;\r\n            }\r\n            else {\r\n                self.bossNode.getComponent(sp.Skeleton).skeletonData = _SkeletonData;\r\n                self.bossNode.getComponent(sp.Skeleton).setAnimation(0, 'idle', true);\r\n                //self.bossNode.getComponent(sp.Skeleton).setSkin(self.roleWeaponName)\r\n            }\r\n        });\r\n    }\r\n\r\n    showHealthValue(){\r\n        let healthNode=cc.find('background/health',this.node);\r\n        let _iconItem=cc.find('lifeIcon',healthNode);\r\n\r\n        for(let i=0;i<this.roleHealthValue;i++){\r\n            let iconItem=cc.instantiate(_iconItem);\r\n            iconItem.parent=healthNode;\r\n            iconItem.active=true\r\n        }\r\n    }\r\n\r\n    initRoleInfo(){\r\n        let roleInfo=GameInfo.getInstance().returnRoleInfo()\r\n        this.roleAniName=roleInfo.roleAniName;\r\n        this.roleWeaponName=roleInfo.roleWeaponName;\r\n        //this._roleHealth.init(GameInfo.getInstance().returnRoleInfo().roleMaxHealth)\r\n        this.roleHealthValue=GameInfo.getInstance().returnRoleInfo().roleMaxHealth;\r\n        this.showHealthValue()\r\n        console.log(roleInfo)\r\n    }\r\n\r\n    update(dt) {\r\n        \r\n    }\r\n\r\n    test(){\r\n        let ts=this.collisionLayer.getComponent('collisionDetection')\r\n        cc.log(ts.boss);\r\n        cc.log(ts.player);\r\n    }\r\n\r\n    private maxBulletCount = 3;\r\n    initBulletPool(){\r\n        this.bulletPool = new cc.NodePool();\r\n        for (let i = 0; i < this.maxBulletCount; ++i) {\r\n            let bullet = cc.instantiate(this.bulletPre); // 创建节点\r\n            this.bulletPool.put(bullet); // 通过 put 接口放入对象池\r\n        }\r\n    }\r\n\r\n    shoot(){\r\n        let bullet=this.createBulletNode();\r\n        let pos=this.LaunchPosition();\r\n        this.playBulletAni(bullet,pos)\r\n    }\r\n\r\n    createBulletNode(){\r\n        let bullet = null;\r\n        if (this.bulletPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\r\n            bullet = this.bulletPool.get();\r\n        } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\r\n            cc.log('子弹数不够')\r\n            //或者可以改变最大子弹数\r\n            // bullet = cc.instantiate(this.bulletPre);\r\n            // this.maxBulletCount++\r\n            //this.bulletPool.put(bullet);\r\n        }\r\n        return bullet\r\n    }\r\n\r\n    LaunchPosition(){\r\n        let _pos=this.playerNode.getComponent('playerControl').onMuzzlePos()\r\n        let playerPos=this.playerNode.getPosition();\r\n        let _x=playerPos.x+_pos.x;\r\n        let _y=playerPos.y+_pos.y;\r\n\r\n        if(!this.playerNode.getComponent('playerControl').Orientation){\r\n            _x=playerPos.x-_pos.x;\r\n        }\r\n\r\n        return new cc.Vec2(_x,_y)\r\n    }\r\n\r\n    playBulletAni(bullet,pos){\r\n        bullet.parent=this.collisionLayer;\r\n        bullet.setPosition(pos);\r\n        \r\n        let to_pos=new cc.Vec2(pos.x+200,pos.y)\r\n        if(!this.playerNode.getComponent('playerControl').Orientation){\r\n            to_pos=new cc.Vec2(pos.x-200,pos.y);\r\n            bullet.scaleX=-1\r\n        }\r\n\r\n        //到达最大射程后回收进pool\r\n        bullet.runAction(cc.sequence(cc.moveTo(1,to_pos).easing(cc.easeIn(1.0)),cc.callFunc(()=>{\r\n            this.bulletPool.put(bullet);\r\n        })))\r\n    }\r\n}\r\n"]}